<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Facturas</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h1>Control de Negocio de Repuestos</h1>
        <nav>
            <ul>
                <li><a href="./inicio.html" onclick="loadPage()">Inicio</a></li>
                <li><a href="./inventario.html" onclick="loadPage('inventario')">Inventario</a></li>
                <li><a href="./ventas.html" onclick="loadPage('ventas')">Ventas</a></li>
                <li><a href="./proveedores.html" onclick="loadPage('proveedores')">Proveedores</a></li>
                <li><a href="./transacciones.html" onclick="loadPage('transacciones')">Transacciones</a></li>
                <li><a href="./facturas.html" onclick="loadPage('facturas')">Facturas</a></li>
                <li><a href="./empleado.html" >empleados</a></li>
                <li><a href="./cliente.html" onclick="loadPage('cliente')">cliente</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section>
            <h2>Buscar Factura</h2>
            <form id="search-form" onsubmit="searchInvoices(event)">
                <label for="search-input">Buscar por número de factura o CC:</label>
                <input type="text" id="search-input" placeholder="Ingrese número de factura o CC" required>
                <button type="submit">Buscar</button>
            </form>

            <h3>Resultados de Búsqueda</h3>
            <table id="invoices-table">
                <thead>
                    <tr>
                        <th>Factura</th>
                        <th>Cliente (CC)</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Método de Pago</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aquí se mostrarán los resultados -->
                </tbody>
            </table>
        </section>
    </main>

    <script src="js/app.js"></script>

    <script>
        // Función para realizar la búsqueda de facturas
        function searchInvoices(event) {
            event.preventDefault(); // Prevenir el envío del formulario

            const searchValue = document.getElementById('search-input').value;

            // Realizar la solicitud GET al servidor para buscar las facturas
            fetch(`/api/invoices?search=${searchValue}`)
                .then(response => response.json())
                .then(data => {
                    updateInvoicesTable(data); // Mostrar las facturas en la tabla
                })
                .catch(error => {
                    console.error('Error al buscar facturas:', error);
                });
        }

        // Función para actualizar la tabla con los resultados de la búsqueda
        function updateInvoicesTable(invoices) {
            const tbody = document.getElementById('invoices-table').getElementsByTagName('tbody')[0];
            tbody.innerHTML = ''; // Limpiar la tabla antes de agregar nuevos resultados

            invoices.forEach(invoice => {
                const row = document.createElement('tr');

                const numberCell = document.createElement('td');
                numberCell.textContent = invoice.index; // Número de factura
                row.appendChild(numberCell);

                const clientCell = document.createElement('td');
                clientCell.textContent = invoice.cc; // Cédula del cliente
                row.appendChild(clientCell);

                const productCell = document.createElement('td');
                productCell.textContent = invoice.productName; // Producto vendido
                row.appendChild(productCell);

                const quantityCell = document.createElement('td');
                quantityCell.textContent = invoice.quantity; // Cantidad vendida
                row.appendChild(quantityCell);

                const paymentMethodCell = document.createElement('td');
                paymentMethodCell.textContent = invoice.paymentMethod; // Método de pago
                row.appendChild(paymentMethodCell);

                const dateCell = document.createElement('td');
                dateCell.textContent = invoice.date; // Fecha de la venta
                row.appendChild(dateCell);

                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>
